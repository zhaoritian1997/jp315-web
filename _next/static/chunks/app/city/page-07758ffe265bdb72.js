(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[345],{7316:function(e,t,a){Promise.resolve().then(a.bind(a,3940))},1483:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(759),n={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},c=a(5705);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var s=r.forwardRef((e,t)=>r.createElement(c.Z,i({},e,{ref:t,icon:n})))},8067:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(759),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},c=a(5705);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var s=r.forwardRef((e,t)=>r.createElement(c.Z,i({},e,{ref:t,icon:n})))},3940:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return $}});var r=a(864),n=a(759),c=a(8445),i=a(2929),s=a(1483),l=a(3870),o=a(9121),u=a.n(o),d=a(8439),h=a(3554),p=a(1021),m=a(5093),v=function(e,t){m.Z&&!(0,p.mf)(e)&&console.error("useDebounceFn expected parameter is a function, got ".concat(typeof e));var a,r=(0,d.Z)(e),c=null!==(a=null==t?void 0:t.wait)&&void 0!==a?a:1e3,i=(0,n.useMemo)(function(){return u()(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.current.apply(r,(0,l.ev)([],(0,l.CR)(e),!1))},c,t)},[]);return(0,h.Z)(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}},f={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z"}}]},name:"close",theme:"outlined"},y=a(5705);function g(){return(g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}let _=n.forwardRef((e,t)=>n.createElement(y.Z,g({},e,{ref:t,icon:f})));var x=a(8067);let C=(0,n.memo)(e=>{var t;let{city:a,onSelect:n,highlightKeyword:c,selected:i=!1}=e;return(0,r.jsx)("div",{onClick:()=>{n(a)},className:"\n        bg-white border border-gray-300 rounded-md px-3 py-2 text-center cursor-pointer\n        transition-all duration-300 font-medium text-sm whitespace-nowrap\n        hover:border-[var(--primary-color,#ad360c)] hover:bg-[var(--secondary-color,#f4e3d5)]\n        hover:transform hover:-translate-y-0.5 hover:shadow-sm\n        ".concat(i?"border-[var(--primary-color,#ad360c)] bg-[var(--secondary-color,#f4e3d5)]":"","\n      "),children:(t=a.name,c?t.split(RegExp("(".concat(c,")"),"gi")).map((e,t)=>e.toLowerCase()===c.toLowerCase()?(0,r.jsx)("span",{className:"text-yellow-600 bg-yellow-50",children:e},t):e):t)})});C.displayName="CityItem";var w=a(1955),N=a.n(w);let b=(0,n.memo)(e=>{let{onSearch:t,searchResults:a,onSelectCity:c,placeholder:i="搜索城市名称..."}=e,[s,l]=(0,n.useState)(""),{run:o}=v(e=>{t(e)},{wait:300}),u=(0,n.useCallback)(e=>{let t=e.target.value;l(t),o(t)},[o]),d=(0,n.useCallback)(()=>{l(""),t("")},[t]),h=(0,n.useCallback)(e=>{c(e),l(""),t("")},[c,t]);return(0,r.jsxs)("div",{className:N().container,children:[(0,r.jsxs)("div",{className:N().searchBox,children:[(0,r.jsx)("input",{type:"text",value:s,onChange:u,placeholder:i,className:N().input}),s&&(0,r.jsx)("button",{onClick:d,className:N().clearButton,"aria-label":"清除搜索",children:(0,r.jsx)(_,{className:"text-sm"})}),(0,r.jsx)("button",{className:N().searchButton,"aria-label":"搜索",children:(0,r.jsx)(x.Z,{className:"text-base"})})]}),s&&a.length>0&&(0,r.jsxs)("div",{className:N().searchResults,children:[(0,r.jsxs)("div",{className:N().resultsTitle,children:["搜索结果 (",a.length,")"]}),(0,r.jsx)("div",{className:N().resultsGrid,children:a.map(e=>(0,r.jsx)(C,{city:e,onSelect:h,highlightKeyword:s},e.id))})]}),s&&0===a.length&&(0,r.jsxs)("div",{className:N().noResults,children:[(0,r.jsx)(x.Z,{className:"text-4xl text-gray-300 mb-4"}),(0,r.jsx)("p",{className:"text-gray-500",children:"未找到匹配的城市"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"请尝试其他关键词或检查拼写"})]})]})});b.displayName="CitySearch";var j=a(238),S=a.n(j);let L=(0,n.memo)(e=>{let{letters:t,activeLetter:a,onLetterClick:c}=e,i=(0,n.useRef)(null),s=e=>{c(e);let t=document.getElementById("city-group-".concat(e));if(t){let e=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:e-90,behavior:"smooth"})}};return(0,r.jsxs)("div",{className:S().container,ref:i,children:[(0,r.jsx)("h2",{className:S().title,children:"按字母选择"}),(0,r.jsx)("div",{className:S().nav,children:t.map(e=>(0,r.jsx)("div",{onClick:()=>s(e),className:"\n              ".concat(S().letterItem,"\n              ").concat(a===e?S().active:"","\n            "),children:e},e))})]})});L.displayName="AlphabetNav";var T=a(1866),B=a.n(T);let R=(0,n.memo)(e=>{let{group:t,onSelectCity:a,searchKeyword:n}=e,{letterRange:c,provinces:i,cities:s}=t,l=n?s.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.pinyin.toLowerCase().includes(n.toLowerCase())||e.provinceName.toLowerCase().includes(n.toLowerCase())):s;return n&&0===l.length?null:(0,r.jsxs)("div",{id:"city-group-".concat(c),className:B().container,children:[(0,r.jsxs)("h3",{className:B().title,children:[(0,r.jsx)("span",{className:B().letterBadge,children:c}),(0,r.jsx)("span",{className:B().provinces,children:i.join("、")})]}),(0,r.jsx)("div",{className:B().grid,children:l.map(e=>(0,r.jsx)(C,{city:e,onSelect:a,highlightKeyword:n},e.id))})]})});R.displayName="CityGroup";var E=a(8448),O=a.n(E);let k=(0,n.memo)(e=>{let{cityGroups:t,onSelectCity:a,searchKeyword:c=""}=e,[i,s]=(0,n.useState)(""),l=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let e=()=>{if(!l.current)return;let e=l.current.querySelectorAll('[id^="city-group-"]'),t=window.scrollY+70+20;for(let a=0;a<e.length;a++){let r=e[a];if(r.getBoundingClientRect().top+window.scrollY<=t)s(r.id.replace("city-group-",""));else break}};return window.addEventListener("scroll",e),e(),()=>{window.removeEventListener("scroll",e)}},[]),(0,r.jsx)("div",{ref:l,className:O().container,children:t.map(e=>(0,r.jsx)(R,{group:e,onSelectCity:a,searchKeyword:c},e.letterRange))})});k.displayName="CityList";var G=a(8195),Z=a(9977);async function A(e){return Z.Z.request({url:"/web/common/city-site/list",method:"get",params:e})}var M=a(5303);let P=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","W","X","Y","Z"],I=()=>{let{data:e,loading:t,error:a}=(0,G.Z)(async()=>{try{let e=await A({pagination:!1});if(!e.data||!e.data.list||0===e.data.list.length)return console.warn("API未返回城市数据"),{cityGroups:[],allCities:[]};let t=function(e){let t=e.map(e=>({id:e.id,name:e.name,pinyin:function(e){try{return(0,M.N9)(e,{toneType:"none",type:"array"}).join(" ")}catch(t){return console.error("生成拼音失败: ".concat(e),t),e}}(e.name),code:e.code,provinceId:e.provinceId,provinceName:e.provinceName}));return{cityGroups:function(e){let t=new Map;e.forEach(e=>{let a="";a=e.pinyin&&e.pinyin.length>0?e.pinyin[0].toUpperCase():e.name[0].toUpperCase(),P.includes(a)&&(t.has(a)||t.set(a,[]),t.get(a).push(e))});let a=[];return P.forEach(e=>{let r=t.get(e)||[];if(r.length>0){let t=Array.from(new Set(r.map(e=>e.provinceName)));a.push({letterRange:e,provinces:t.sort(),cities:r.sort((e,t)=>e.name.localeCompare(t.name,"zh-CN"))})}}),a}(t),allCities:t}}(e.data.list);return await new Promise(e=>setTimeout(e,100)),t}catch(e){return console.error("API调用失败:",e),{cityGroups:[],allCities:[]}}},{cacheKey:"city-site-list-data",staleTime:6e5});return{data:e||null,loading:t,error:(null==a?void 0:a.message)||null}};var K=a(2803),H=a(3472),z=a(7963),Y=a.n(z);let q=()=>a(5640).getStorage(),F=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","W","X","Y","Z"],D=(0,n.memo)(e=>{let{className:t}=e,a=(0,i.useRouter)(),[c,l]=(0,n.useState)(""),[o,u]=(0,n.useState)(""),{data:d,loading:h}=I(),{cityGroups:p=[],allCities:m=[]}=d||{},v=(0,n.useMemo)(()=>{if(!c||!m.length)return[];let e=c.toLowerCase();return m.filter(t=>t.name.includes(c)||t.pinyin.toLowerCase().includes(e)||t.provinceName.includes(c))},[c,m]),f=(0,n.useCallback)(e=>{let t=q();t&&t.set("selectedCity",e),e.code&&K.X.setCityCode(e.code),H.y.success("已选择 ".concat(e.name));let r=new URLSearchParams(window.location.search).get("redirect")||"/";setTimeout(()=>{a.push(r)},1e3)},[a]);return h?(0,r.jsx)("div",{className:"".concat(Y().container," ").concat(t||""),children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(s.Z,{className:"text-4xl text-[var(--primary-color,#ad360c)] animate-spin"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载城市数据中..."})]})}):(0,r.jsxs)("div",{className:"".concat(Y().container," ").concat(t||""),children:[(0,r.jsxs)("div",{className:Y().pageHeader,children:[(0,r.jsx)("h1",{className:Y().mainTitle,children:"选择您的地区"}),(0,r.jsx)("p",{className:Y().subTitle,children:"请选择您所在的地区，我们将为您提供针对性的族谱修谱服务"})]}),(0,r.jsx)(b,{onSearch:l,searchResults:v,onSelectCity:f}),(0,r.jsx)(L,{letters:F,activeLetter:o,onLetterClick:u}),(0,r.jsx)(k,{cityGroups:p,onSelectCity:f,searchKeyword:c})]})});D.displayName="CitySelection";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z"}}]},name:"vertical-align-top",theme:"outlined"};function Q(){return(Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}let X=n.forwardRef((e,t)=>n.createElement(y.Z,Q({},e,{ref:t,icon:U})));var V=a(6730),W=a.n(V),J=e=>{let{visibilityHeight:t=400,duration:a=300,position:c="right"}=e,[i,s]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=()=>{s(window.scrollY>t)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[t]),i)?(0,r.jsx)("button",{onClick:()=>{let e=performance.now(),t=window.scrollY,r=n=>{let c=Math.min((n-e)/a,1);window.scrollTo(0,t*(1-(c<.5?4*c*c*c:1-Math.pow(-2*c+2,3)/2))),c<1&&requestAnimationFrame(r)};requestAnimationFrame(r)},className:"\n        ".concat(W().backToTop,"\n        ").concat("right"===c?W().right:W().left,"\n      "),title:"回到顶部","aria-label":"回到顶部",children:(0,r.jsx)(X,{})}):null};function $(){return(0,r.jsxs)(c.default,{children:[(0,r.jsx)(D,{}),(0,r.jsx)(J,{})]})}},238:function(e){e.exports={container:"AlphabetNav_container__tVLpH",title:"AlphabetNav_title__1b_n7",nav:"AlphabetNav_nav__o8UX3",letterItem:"AlphabetNav_letterItem__9UNBE",active:"AlphabetNav_active__PEDw2"}},1866:function(e){e.exports={container:"CityGroup_container__OchzR",title:"CityGroup_title__pvWrC",letterBadge:"CityGroup_letterBadge__IdEGd",provinces:"CityGroup_provinces__vLcMC",grid:"CityGroup_grid__Suf2_"}},8448:function(e){e.exports={container:"CityList_container__qusAI"}},1955:function(e){e.exports={container:"CitySearch_container__NHxlh",searchBox:"CitySearch_searchBox__6sLii",input:"CitySearch_input__Fv6jQ",clearButton:"CitySearch_clearButton__h5rtM",searchButton:"CitySearch_searchButton__bu0iL",searchResults:"CitySearch_searchResults__XNNd7",resultsTitle:"CitySearch_resultsTitle__frxLg",resultsGrid:"CitySearch_resultsGrid__h9QRU",noResults:"CitySearch_noResults__5Dvf2"}},7963:function(e){e.exports={container:"CitySelection_container__i1KxK",pageHeader:"CitySelection_pageHeader__95bty",mainTitle:"CitySelection_mainTitle__pN8f2",subTitle:"CitySelection_subTitle__feOQK"}},6730:function(e){e.exports={backToTop:"BackToTop_backToTop__D1TTp",right:"BackToTop_right__PqubY",left:"BackToTop_left__FPqe0"}}},function(e){e.O(0,[340,352,955,732,195,517,259,973,744],function(){return e(e.s=7316)}),_N_E=e.O()}]);